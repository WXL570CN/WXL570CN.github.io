(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{343:function(t,s,a){"use strict";a.r(s);var e=a(7),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"query-retries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#query-retries"}},[t._v("#")]),t._v(" Query Retries")]),t._v(" "),a("p",[t._v("当 useQuery 查询失败（查询函数抛出错误）时，如果该查询的请求未达到最大连续重试次数（默认为 3）或提供了一个函数来确定是否重试，TanStack Query 将自动重试查询允许。")]),t._v(" "),a("p",[t._v("您可以在全局级别和单个查询级别配置重试。")]),t._v(" "),a("ul",[a("li",[t._v("设置 retry = false 将禁用重试。")]),t._v(" "),a("li",[t._v("设置 retry = 6 将在显示函数抛出的最终错误之前重试失败的请求 6 次。")]),t._v(" "),a("li",[t._v("设置 retry = true 将无限重试失败的请求。")]),t._v(" "),a("li",[t._v("设置 retry = (failureCount, error) => ... 允许基于请求失败原因的自定义逻辑。")])]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" useQuery "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@tanstack/react-query'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Make a specific query retry a certain number of timesconst result = useQuery({  queryKey: ['todos', 1],  queryFn: fetchTodoListPage,  retry: 10, // Will retry failed requests 10 times before displaying an error})")]),t._v("\n")])])]),a("p",[t._v("[")]),t._v(" "),a("h2",{attrs:{id:"重试延迟"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重试延迟"}},[t._v("#")]),t._v(" 重试延迟")]),t._v(" "),a("p",[t._v("](https://tanstack.com/query/latest/docs/react/guides/query-retries#retry-delay)")]),t._v(" "),a("p",[t._v("默认情况下，TanStack Query 中的重试不会在请求失败后立即发生。按照标准，每次重试都会逐渐应用回退延迟。")]),t._v(" "),a("p",[t._v("每次尝试的默认 retryDelay 设置为双倍（从 1000 毫秒开始），但不超过 30 秒：")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Configure for all queriesimport {  QueryCache,  QueryClient,  QueryClientProvider,} from '@tanstack/react-query'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" queryClient "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryClient")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  defaultOptions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    queries"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("retryDelay")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("attemptIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("min")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v(" attemptIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("App")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryClientProvider")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("client")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("queryClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryClientProvider")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("虽然不推荐，但您显然可以在提供者和个人查询选项中覆盖 retryDelay 函数/整数。如果设置为整数而不是函数，延迟将始终是相同的时间量：")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  queryKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'todos'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  queryFn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" fetchTodoList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  retryDelay"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Will always wait 1000ms to retry, regardless of how many retries})")]),t._v("\n")])])]),a("p",[a("a",{attrs:{href:"https://github.com/tanstack/query/tree/main/docs/react/guides/query-retries.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("在 GitHub 上编辑"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://tanstack.com/query/latest/docs/react/guides/disabling-queries",target:"_blank",rel:"noopener noreferrer"}},[t._v("反"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);