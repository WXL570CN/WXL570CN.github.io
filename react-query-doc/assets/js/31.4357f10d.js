(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{357:function(t,a,s){"use strict";s.r(a);var e=s(7),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"querycache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#querycache"}},[t._v("#")]),t._v(" QueryCache")]),t._v(" "),s("p",[t._v("QueryCache 是 TanStack Query 的存储机制。它存储它包含的所有数据、元信息和查询状态。")]),t._v(" "),s("p",[s("strong",[t._v("通常，您不会直接与 QueryCache 交互，而是将 QueryClient 用于特定缓存。")])]),t._v(" "),s("div",{staticClass:"language-tsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-tsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" QueryCache "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@tanstack/react-query'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" queryCache "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" error "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onSuccess")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onSettled")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" query "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" queryKey"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'posts'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("它可用的方法有：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://tanstack.com/query/latest/docs/react/reference/QueryCache#querycachefind",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("寻找")]),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://tanstack.com/query/latest/docs/react/reference/QueryCache#querycachefindall",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("找到所有")]),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://tanstack.com/query/latest/docs/react/reference/QueryCache#querycachesubscribe",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("订阅")]),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://tanstack.com/query/latest/docs/react/reference/QueryCache#querycacheclear",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("清除")]),s("OutboundLink")],1)])]),t._v(" "),s("p",[s("strong",[t._v("选项")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("onError?: (error: unknown, query: Query) => 无效")]),t._v(" "),s("ul",[s("li",[t._v("选修的")]),t._v(" "),s("li",[t._v("如果某些查询遇到错误，将调用此函数。")])])]),t._v(" "),s("li",[s("code",[t._v("onSuccess?: (data: unknown, query: Query) => 无效")]),t._v(" "),s("ul",[s("li",[t._v("选修的")]),t._v(" "),s("li",[t._v("如果某些查询成功，将调用此函数。")])])]),t._v(" "),s("li",[t._v("onSettled?: (data: unknown | undefined, error: unknown | null, query: Query) => 无效\n"),s("ul",[s("li",[t._v("选修的")]),t._v(" "),s("li",[t._v("如果某些查询已解决（成功或错误），将调用此函数。")])])])]),t._v(" "),s("p",[t._v("[")]),t._v(" "),s("h2",{attrs:{id:"全局回调"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#全局回调"}},[t._v("#")]),t._v(" 全局回调")]),t._v(" "),s("p",[t._v("](https://tanstack.com/query/latest/docs/react/reference/QueryCache#global-callbacks)")]),t._v(" "),s("p",[t._v("QueryCache 上的 onError、onSuccess 和 onSettled 回调可用于在全局级别处理这些事件。它们与提供给 QueryClient 的 defaultOptions 不同，因为：")]),t._v(" "),s("ul",[s("li",[t._v("defaultOptions 可以被每个 Query 覆盖——全局回调将始终被调用。")]),t._v(" "),s("li",[t._v("defaultOptions 回调将为每个 Observer 调用一次，而全局回调只会为每个 Query 调用一次。")])]),t._v(" "),s("p",[t._v("[")]),t._v(" "),s("h2",{attrs:{id:"查询缓存-find"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询缓存-find"}},[t._v("#")]),t._v(" "),s("code",[t._v("查询缓存.find")])]),t._v(" "),s("p",[t._v("](https://tanstack.com/query/latest/docs/react/reference/QueryCache#querycachefind)")]),t._v(" "),s("p",[t._v("find 是一种稍微高级的同步方法，可用于从缓存中获取现有的查询实例。该实例不仅包含查询的所有状态，还包含查询的所有实例和底层内容。如果查询不存在，将返回 undefined。")]),t._v(" "),s("blockquote",[s("p",[t._v("注意：大多数应用程序通常不需要这，但在极少数情况下需要有关查询的更多信息时可以派上用场（例如，查看 query.state.dataUpdatedAt 时间戳以确定查询是否足够新鲜以用作初始值）")])]),t._v(" "),s("div",{staticClass:"language-tsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-tsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" query "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" queryKey "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("选项")])]),t._v(" "),s("ul",[s("li",[t._v("filters?: QueryFilters: 查询过滤器")])]),t._v(" "),s("p",[s("strong",[t._v("Returns")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("询问")]),t._v(" "),s("ul",[s("li",[t._v("来自缓存的查询实例")])])])]),t._v(" "),s("p",[t._v("[")]),t._v(" "),s("h2",{attrs:{id:"查询缓存-findall"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询缓存-findall"}},[t._v("#")]),t._v(" "),s("code",[t._v("查询缓存.findAll")])]),t._v(" "),s("p",[t._v("](https://tanstack.com/query/latest/docs/react/reference/QueryCache#querycachefindall)")]),t._v(" "),s("p",[t._v("findAll 是更高级的同步方法，可用于从缓存中获取与查询键部分匹配的现有查询实例。如果查询不存在，将返回空数组。")]),t._v(" "),s("blockquote",[s("p",[t._v("注意：大多数应用程序通常不需要这，但在极少数情况下需要有关查询的更多信息时可以派上用场")])]),t._v(" "),s("div",{staticClass:"language-tsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-tsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" queries "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" queryKey "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("选项")])]),t._v(" "),s("ul",[s("li",[t._v("filters?: QueryFilters: 查询过滤器")])]),t._v(" "),s("p",[s("strong",[t._v("Returns")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("询问[]")]),t._v(" "),s("ul",[s("li",[t._v("从缓存中查询实例")])])])]),t._v(" "),s("p",[t._v("[")]),t._v(" "),s("h2",{attrs:{id:"查询缓存-订阅"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询缓存-订阅"}},[t._v("#")]),t._v(" "),s("code",[t._v("查询缓存.订阅")])]),t._v(" "),s("p",[t._v("](https://tanstack.com/query/latest/docs/react/reference/QueryCache#querycachesubscribe)")]),t._v(" "),s("p",[t._v("subscribe 方法可用于订阅整个查询缓存，并获知缓存的安全/已知更新，例如查询状态更改或查询被更新、添加或删除")]),t._v(" "),s("div",{staticClass:"language-tsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-tsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("callback")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" unsubscribe "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("选项")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("回调：（事件：QueryCacheNotifyEvent）=>无效")]),t._v(" "),s("ul",[s("li",[t._v("每当查询缓存通过其跟踪更新机制（例如，query.setState、queryClient.removeQueries 等）进行更新时，都会调用此函数。不鼓励对缓存进行超出范围的突变，并且不会触发订阅回调")])])])]),t._v(" "),s("p",[s("strong",[t._v("Returns")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("退订：功能=>无效")]),t._v(" "),s("ul",[s("li",[t._v("此函数将从查询缓存中取消订阅回调。")])])])]),t._v(" "),s("p",[t._v("[")]),t._v(" "),s("h2",{attrs:{id:"查询缓存-clear"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询缓存-clear"}},[t._v("#")]),t._v(" "),s("code",[t._v("查询缓存.clear")])]),t._v(" "),s("p",[t._v("](https://tanstack.com/query/latest/docs/react/reference/QueryCache#querycacheclear)")]),t._v(" "),s("p",[t._v("clear 方法可用于完全清除缓存并重新开始。")]),t._v(" "),s("div",{staticClass:"language-tsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-tsx"}},[s("code",[t._v("queryCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("[")]),t._v(" "),s("h2",{attrs:{id:"延伸阅读"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#延伸阅读"}},[t._v("#")]),t._v(" 延伸阅读")]),t._v(" "),s("p",[t._v("](https://tanstack.com/query/latest/docs/react/reference/QueryCache#further-reading)")]),t._v(" "),s("p",[t._v("要更好地了解 QueryCache 的内部工作方式，请查看社区资源中的 #18：Inside React Query。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/tanstack/query/tree/main/docs/react/reference/QueryCache.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("在 GitHub 上编辑"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);