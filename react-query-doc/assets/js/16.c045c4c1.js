(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{339:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"window-focus-refetching"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#window-focus-refetching"}},[t._v("#")]),t._v(" Window Focus Refetching")]),t._v(" "),a("p",[t._v("如果用户离开您的应用程序并返回并且查询数据已过时，TanStack Query 会自动在后台为您请求新数据。您可以使用 refetchOnWindowFocus 选项全局或按查询禁用此功能：")]),t._v(" "),a("p",[t._v("[")]),t._v(" "),a("h4",{attrs:{id:"全局禁用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局禁用"}},[t._v("#")]),t._v(" 全局禁用")]),t._v(" "),a("p",[t._v("](https://tanstack.com/query/latest/docs/react/guides/window-focus-refetching#disabling-globally)")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//const queryClient = new QueryClient({  defaultOptions: {    queries: {      refetchOnWindowFocus: false, // default: true    },  },})")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("App")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryClientProvider")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("client")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("queryClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryClientProvider")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("[")]),t._v(" "),a("h4",{attrs:{id:"禁用每个查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#禁用每个查询"}},[t._v("#")]),t._v(" 禁用每个查询")]),t._v(" "),a("p",[t._v("](https://tanstack.com/query/latest/docs/react/guides/window-focus-refetching#disabling-per-query)")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  queryKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'todos'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  queryFn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" fetchTodos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  refetchOnWindowFocus"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("[")]),t._v(" "),a("h2",{attrs:{id:"自定义窗口焦点事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义窗口焦点事件"}},[t._v("#")]),t._v(" 自定义窗口焦点事件")]),t._v(" "),a("p",[t._v("](https://tanstack.com/query/latest/docs/react/guides/window-focus-refetching#custom-window-focus-event)")]),t._v(" "),a("p",[t._v("在极少数情况下，您可能希望管理自己的窗口焦点事件，这些事件会触发 TanStack 查询重新生效。为此，TanStack Query 提供了一个 focusManager.setEventListener 函数，该函数为您提供在窗口聚焦时应触发的回调，并允许您设置自己的事件。当调用 focusManager.setEventListener 时，先前设置的处理程序将被删除（在大多数情况下将是默认处理程序）并使用您的新处理程序。例如，这是默认处理程序：")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[t._v("focusManager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handleFocus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Listen to visibilitychange and focus  if (typeof window !== 'undefined' && window.addEventListener) {    window.addEventListener('visibilitychange', handleFocus, false)    window.addEventListener('focus', handleFocus, false)  }")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Be sure to unsubscribe if a new handler is set    window.removeEventListener('visibilitychange', handleFocus)    window.removeEventListener('focus', handleFocus)  }})")]),t._v("\n")])])]),a("p",[t._v("[")]),t._v(" "),a("h2",{attrs:{id:"忽略-iframe-焦点事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#忽略-iframe-焦点事件"}},[t._v("#")]),t._v(" 忽略 iframe 焦点事件")]),t._v(" "),a("p",[t._v("](https://tanstack.com/query/latest/docs/react/guides/window-focus-refetching#ignoring-iframe-focus-events)")]),t._v(" "),a("p",[t._v("替换焦点处理程序的一个很好的用例是 iframe 事件。 iframe 在应用程序中聚焦或使用 iframe 时，通过双重触发事件和误报事件来检测窗口焦点时会出现问题。如果遇到这种情况，您应该使用尽可能忽略这些事件的事件处理程序。我推荐这个！它可以通过以下方式设置：")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" focusManager "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@tanstack/react-query'")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" onWindowFocus "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./onWindowFocus'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The gist above")]),t._v("\nfocusManager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("onWindowFocus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Boom!")]),t._v("\n")])])]),a("p",[t._v("[")]),t._v(" "),a("h2",{attrs:{id:"在-react-native-中管理焦点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-react-native-中管理焦点"}},[t._v("#")]),t._v(" 在 React Native 中管理焦点")]),t._v(" "),a("p",[t._v("](https://tanstack.com/query/latest/docs/react/guides/window-focus-refetching#managing-focus-in-react-native)")]),t._v(" "),a("p",[t._v("React Native 不是窗口上的事件监听器，而是通过 AppState 模块提供焦点信息。当应用程序状态变为“活动”时，您可以使用 AppState“更改”事件触发更新：")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" AppState "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react-native'")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" focusManager "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@tanstack/react-query'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onAppStateChange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("status"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" AppStateStatus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Platform"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'web'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    focusManager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setFocused")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'active'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useEffect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" subscription "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" AppState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'change'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" onAppStateChange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" subscription"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("remove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("[")]),t._v(" "),a("h2",{attrs:{id:"管理焦点状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#管理焦点状态"}},[t._v("#")]),t._v(" 管理焦点状态")]),t._v(" "),a("p",[t._v("](https://tanstack.com/query/latest/docs/react/guides/window-focus-refetching#managing-focus-state)")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" focusManager "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@tanstack/react-query'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Override the default focus statefocusManager.setFocused(true)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Fallback to the default focus checkfocusManager.setFocused(undefined)")]),t._v("\n")])])]),a("p",[t._v("[")]),t._v(" "),a("h2",{attrs:{id:"陷阱和注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#陷阱和注意事项"}},[t._v("#")]),t._v(" 陷阱和注意事项")]),t._v(" "),a("p",[t._v("](https://tanstack.com/query/latest/docs/react/guides/window-focus-refetching#pitfalls--caveats)")]),t._v(" "),a("p",[t._v("一些浏览器内部对话窗口，例如由 alert() 生成的或文件上传对话（由 "),a("input",{attrs:{type:"file"}}),t._v(" 创建）也可能在关闭后触发焦点重新获取。这可能会导致不需要的副作用，因为重新获取可能会在执行文件上传处理程序之前触发组件卸载或重新安装。有关背景和可能的解决方法，请参阅 GitHub 上的此问题。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/tanstack/query/tree/main/docs/react/guides/window-focus-refetching.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("在 GitHub 上编辑"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);