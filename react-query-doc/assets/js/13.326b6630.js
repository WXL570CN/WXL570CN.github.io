(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{338:function(t,s,a){"use strict";a.r(s);var e=a(7),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"parallel-queries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parallel-queries"}},[t._v("#")]),t._v(" Parallel Queries")]),t._v(" "),a("p",[t._v("“并行”查询是并行执行或同时执行的查询，以最大限度地提高获取并发性。")]),t._v(" "),a("p",[t._v("[")]),t._v(" "),a("h2",{attrs:{id:"手动并行查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手动并行查询"}},[t._v("#")]),t._v(" 手动并行查询")]),t._v(" "),a("p",[t._v("](https://tanstack.com/query/latest/docs/react/guides/parallel-queries#manual-parallel-queries)")]),t._v(" "),a("p",[t._v("当并行查询的数量不变时，使用并行查询就没有额外的努力。只需同时使用任意数量的 TanStack Query 的 useQuery 和 useInfiniteQuery 挂钩！")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("App")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The following queries will execute in parallel  const usersQuery = useQuery({ queryKey: ['users'], queryFn: fetchUsers })  const teamsQuery = useQuery({ queryKey: ['teams'], queryFn: fetchTeams })  const projectsQuery = useQuery({ queryKey: ['projects'], queryFn: fetchProjects })  ...}")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("在挂起模式下使用 React Query 时，这种并行模式不起作用，因为第一个查询会在内部抛出一个 promise 并会在其他查询运行之前挂起组件。要解决这个问题，您要么需要使用 useQueries 挂钩（建议这样做），要么为每个 useQuery 实例使用单独的组件来编排您自己的并行性（这是蹩脚的）。")])]),t._v(" "),a("p",[t._v("[")]),t._v(" "),a("h2",{attrs:{id:"使用-usequeries-的动态并行查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-usequeries-的动态并行查询"}},[t._v("#")]),t._v(" 使用 useQueries 的动态并行查询")]),t._v(" "),a("p",[t._v("](https://tanstack.com/query/latest/docs/react/guides/parallel-queries#dynamic-parallel-queries-with-usequeries)")]),t._v(" "),a("p",[t._v("如果您需要执行的查询数量在不同的渲染之间发生变化，则您不能使用手动查询，因为这会违反挂钩规则。相反，TanStack Query 提供了一个 useQueries 挂钩，您可以使用它来动态地并行执行任意数量的查询。")]),t._v(" "),a("p",[t._v("useQueries 接受带有查询键的选项对象，其值为查询对象数组。它返回一个查询结果数组：")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("App")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" users "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" userQueries "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useQueries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    queries"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("        queryKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("queryFn")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetchUserById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("a",{attrs:{href:"https://github.com/tanstack/query/tree/main/docs/react/guides/parallel-queries.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("在 GitHub 上编辑"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);