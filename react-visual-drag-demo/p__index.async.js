(self.webpackChunk=self.webpackChunk||[]).push([[866],{22387:function(Pe,A,v){"use strict";v.r(A),v.d(A,{default:function(){return be}});var H=v(16854),I=v.n(H),g=v(54573),X={"drag-com-list":"drag-com-list___HNdKj",list:"list___DUYsi",iconfont:"iconfont___AqFtN","icon-wenben":"icon-wenben___f1NRt","icon-biaoge":"icon-biaoge___V8pn2","icon-tupian":"icon-tupian___zzsDD"},o=v(32648),k=function(t){var n=function(r){r.dataTransfer.setData("comType",r.target.dataset.type)};return(0,o.jsx)("div",{className:X["drag-com-list"],onDragStart:n,children:g.d2.map(function(a,r){return(0,o.jsx)("div",{className:X.list,draggable:!0,"data-index":r,"data-type":a.type,children:(0,o.jsx)("i",{className:"iconfont ".concat(a.icon)})},r)})})},z=k,G=v(67104),p=v.n(G),j=v(77617),S=v(64515),J=function(t){return(0,o.jsxs)("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg",style:{position:"relative",top:0,left:0},children:[(0,o.jsxs)("defs",{children:[(0,o.jsx)("pattern",{id:"smallGrid",width:"7.236328125",height:"7.236328125",patternUnits:"userSpaceOnUse",children:(0,o.jsx)("path",{d:"M 7.236328125 0 L 0 0 0 7.236328125",fill:"none",stroke:"rgba(207, 207, 207, 0.3)","stroke-width":"1"})}),(0,o.jsxs)("pattern",{id:"grid",width:"36.181640625",height:"36.181640625",patternUnits:"userSpaceOnUse",children:[(0,o.jsx)("rect",{width:"36.181640625",height:"36.181640625",fill:"url(#smallGrid)"}),(0,o.jsx)("path",{d:"M 36.181640625 0 L 0 0 0 36.181640625",fill:"none",stroke:"rgba(186, 186, 186, 0.5)","stroke-width":"1"})]})]}),(0,o.jsx)("rect",{width:"100%",height:"100%",fill:"url(#grid)"})]})},Z=J,B={lt:V,t:$,rt:W,r:q,rb:K,b:ee,lb:Q,l:te};function V(e,t){var n=e.width,a=e.height,r=e.top,l=e.left,i=Math.max(0,t.x),s=Math.max(0,t.y),c=l-i,d=r-s;e.width=n+c,e.height=a+d,e.top=s,e.left=i}function W(e,t,n){var a=e.height,r=e.top,l=e.left,i=Math.max(0,Math.min(n.width,t.x)),s=Math.max(0,t.y),c=i-l,d=r-s;e.width=c,e.height=a+d,e.top=s}function K(e,t,n){var a=e.top,r=e.left,l=Math.max(0,Math.min(n.width,t.x)),i=Math.max(0,Math.min(n.height,t.y)),s=l-r,c=i-a;e.width=s,e.height=c}function Q(e,t,n){var a=e.width,r=e.top,l=e.left,i=Math.max(0,t.x),s=Math.max(0,Math.min(n.height,t.y)),c=l-i,d=s-r;e.width=a+c,e.height=d,e.left=i}function $(e,t){var n=e.height,a=e.top;if(!(t.y<0)){var r=a-t.y;e.height=n+r,e.top=t.y}}function q(e,t,n){var a=n.width;if(!(t.x>a)){var r=t.x-e.left;e.width=r}}function ee(e,t,n){var a=n.height;t.y>a||(e.height=t.y-e.top)}function te(e,t){var n=e.width,a=e.left;if(!(t.x<0)){var r=a-t.x;e.width=n+r,e.left=t.x}}function ne(e,t,n,a){B[e](t,n,a)}function ae(e,t,n,a){var r=a.width,l=a.height,i=n.x+t.left,s=n.y+t.top;e.left=Math.max(0,Math.min(i,r-e.width)),e.top=Math.max(0,Math.min(s,l-e.height))}var re=function(t,n){var a=n.width,r=n.height,l=a/2,i=r/2,s={lt:[0,0],rt:[a,0],lb:[0,r],rb:[a,r],t:[l,0],b:[l,r],l:[0,Math.floor(i)],r:[a,Math.floor(i)]}[t];return{marginLeft:"-4px",marginTop:"-4px",left:"".concat(s[0],"px"),top:"".concat(s[1],"px"),cursor:g.uJ[t]}},R={shape:"shape___VmOGv","shape-point":"shape-point___qcRVh",delete:"delete___JJKkb",active:"active___bNgQ4"},oe=function(t){var n=t.dispatch,a=t.style,r=t.element,l=t.children,i=t.editorClient,s=t.isPreview,c=t.curComponent,d=function(m){n({type:"drag/setIsClickComponent",payload:!0}),m.stopPropagation(),n({type:"drag/setCurComponent",payload:r});var u=p()({},a),h={x:m.clientX,y:m.clientY},w={top:Number(u.top),left:Number(u.left)},x=function(L){var O={x:L.clientX-h.x,y:L.clientY-h.y};ae(u,w,O,g.YA),n({type:"drag/updateCurComponent",payload:u})},y=function _(){document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",_)};document.addEventListener("mousemove",x),document.addEventListener("mouseup",y)},C=function(m,u){if(!s){u.stopPropagation(),u.preventDefault();var h=p()({},a),w=function(_){var L={x:_.clientX-Math.round(i.left),y:_.clientY-Math.round(i.top)};ne(m,h,L,g.YA),n({type:"drag/updateCurComponent",payload:h,element:r})},x=function y(){document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",y)};document.addEventListener("mousemove",w),document.addEventListener("mouseup",x)}},D=!s&&(c==null?void 0:c.id)===r.id;return(0,o.jsxs)("div",{className:"".concat(R.shape," ").concat(D?R.active:""),onMouseDown:d,style:a,children:[D&&g.mw.map(function(f){return(0,o.jsx)("div",{className:"".concat(R["shape-point"]," "),style:re(f,a),onMouseDown:function(u){C(f,u)}},f)}),l]})},U=(0,S.connect)(function(e){return e.drag})(oe),ie={editor:"editor___wGPeX",lock:"lock___PlZuI"},le=j.forwardRef(function(e,t){var n=(0,S.useSelector)(function(c){return c.drag}),a=n.curComponent,r=n.realtimeList,l=(0,j.useRef)(null),i=function(){var d;return(d=l.current)===null||d===void 0?void 0:d.getBoundingClientRect()};(0,j.useImperativeHandle)(t,function(){return{editorClient:i()}});var s=function(d){a||d.preventDefault()};return(0,o.jsxs)("div",{ref:l,className:ie.editor,style:g.YA,onMouseDown:s,children:[(0,o.jsx)(Z,{}),r.map(function(c,d){var C=g.Iq[c.type];return(0,o.jsx)(U,{style:c.style,element:c,editorClient:i(),children:(0,o.jsx)(C,p()({},c))},c.id)})]})}),ce=le,se=v(48163),N=v(37103),de={"preview-modal":"preview-modal___HfH8T"},ue=function(t){var n=t.visible,a=t.realtimeList,r=(0,j.useRef)(null),l=(0,j.useState)(0),i=I()(l,2),s=i[0],c=i[1];(0,j.useEffect)(function(){n&&c(d())},[n]);var d=function(){var f=r.current||{},m=f.clientHeight,u=f.clientWidth;return(0,N.yZ)(g.YA.width,g.YA.height,u,m)},C=function(){return(0,o.jsx)("div",{style:p()(p()({},g.YA),{},{position:"relative",transform:"scale(".concat(s,")"),transformOrigin:"0% 0%"}),children:a.map(function(f,m){var u=g.Iq[f.type];return(0,o.jsx)(U,{style:f.style,isPreview:!0,children:(0,o.jsx)(u,p()(p()({},f),{},{visible:!0}))},f.id)})})};return(0,o.jsx)(se.Z,p()(p()({title:"\u9884\u89C8"},t),{},{width:800,footer:null,forceRender:!0,className:de["preview-modal"],children:(0,o.jsx)("div",{ref:r,style:{width:"100%",height:"100%"},children:s&&C()})}))},he=(0,S.connect)(function(e){return e.drag})(ue),b={"real-time-component-list":"real-time-component-list___DixQO",list:"list___xS3kl","icon-container":"icon-container___PdGfq",name:"name___EmUss",actived:"actived___EVn_J"},ve=function(t){var n=t.dispatch,a=t.realtimeList;return(0,o.jsx)("div",{className:b["real-time-component-list"],children:a.map(function(r,l){return(0,o.jsxs)("div",{className:"flex_start_center ".concat(b.list),children:[(0,o.jsx)("i",{className:"iconfont ".concat(r.icon)}),(0,o.jsx)("span",{className:b.name,children:r.label}),(0,o.jsxs)("div",{className:b["icon-container"],children:[(0,o.jsx)("i",{className:"iconfont icon-drag-up",onClick:function(){n({type:"drag/moveUpComponent",payload:l})}}),(0,o.jsx)("i",{className:"iconfont icon-drag-down",onClick:function(){n({type:"drag/moveDownComponent",payload:l})}}),(0,o.jsx)("i",{className:"iconfont icon-drag-delete",onClick:function(){n({type:"drag/deleteComponent",payload:r.id})}})]})]},l)})})},fe=(0,S.connect)(function(e){return p()({},e.drag)})(ve),me=v(28911),T=v(18893),E=v(89392),P=v(36798),pe=["top","left","width","height","fontSize"];function ge(e,t){var n=t.realtimeList,a=t.canvasStyle,r=(0,E.cloneDeep)(n);return r.forEach(function(l){Object.keys(l.style).forEach(function(i){if(pe.includes(i)){if(i==="fontSize"&&l.style[i]==="")return;l.style[i]=F(Ce(l.style[i],store.state.canvasStyleData.scale),e)}})}),{realtimeList:r,canvasStyle:p()(p()({},a),{},{scale:e})}}var xe=null;function Re(e,t){Object.keys(e.style).forEach(function(n){if(xe.includes(n)){if(n==="fontSize"&&e.style[n]==="")return;e.style[n]=F(e.style[n],t)}})}function F(e,t){return(0,P.JpY)(e,(0,P.csF)(parseFloat(t),100))}function Ce(e,t){return(0,P.csF)(e,(0,P.csF)(parseFloat(t),100))}var we={set:function(t){var n={name:" ",value:"",expires:"",startTime:new Date().getTime()},a={};if(console.log("\u300Eparams\u300F",t),Object.assign(a,n,t),console.log("\u300Eoptions\u300F",a),a.expires)localStorage.setItem(a.name,JSON.stringify(a));else{var r=Object.prototype.toString.call(a.value);(r==="[object Object]"||r==="[object Array]")&&(a.value=JSON.stringify(a.value)),console.log("\u300Eoptions\u300F",a),localStorage.setItem(a.name,a.value)}},get:function(t){var n=localStorage.getItem(t);try{n=JSON.parse(n)}catch(r){return n}if((0,E.isObject)(n)&&n.startTime){var a=new Date().getTime();return a-n.startTime>n.expires?(localStorage.removeItem(t),!1):n.value}return n},remove:function(t){localStorage.removeItem(t)},clear:function(){localStorage.clear()}},je=we,ye={insert:"insert___jDqYs"},Se=function(t){var n=function(r){var l=r.target.files[0];if(!l.type.includes("image")){toast("\u53EA\u80FD\u63D2\u5165\u56FE\u7247");return}var i=new FileReader;i.onload=function(s){var c=s.target.result,d=new Image;d.onload=function(){t.onChange({url:c,width:d.width,height:d.height})},d.src=c},i.readAsDataURL(l)};return(0,o.jsxs)("label",{for:"input",className:ye.insert,children:["\u63D2\u5165\u56FE\u7247",(0,o.jsx)("input",{id:"input",type:"file",hidden:!0,onChange:n})]})},De=(0,S.connect)(function(e){return e.drag})(Se),_e={toolbar:"toolbar___NSLzd","canvas-config":"canvas-config___pkiFM"},Le=function(t){var n=t.dispatch,a=t.onPreview,r=t.realtimeList,l=t.canvasStyle,i=function(){},s=function(){},c=function(){},d=function(){je.set({name:"drag_data",value:r}),me.ZP.success("\u4FDD\u5B58\u6210\u529F\uFF01")},C=function(){n({type:"drag/setRealtimeList",payload:[]})([])},D=function(){},f=function(){},m=function(){},u=function(w){var x=w||{},y=x.width,_=x.height,L=x.url,O=(0,N.jD)(g.d2,g.mM.IMG,{valueName:"type"}),Y=p()(p()({},O),{},{propValue:L,style:p()({top:0,left:0},(0,N.lk)(y,_))});ge(Y,{realtimeList:r,canvasStyle:l}),n({type:"drag/setCurComponent",payload:Y}),n({type:"drag/addRealtimeList",payload:Y})};return(0,o.jsxs)("div",{className:"flex_start_center ".concat(_e.toolbar),children:[(0,o.jsx)(De,{onChange:u}),(0,o.jsx)(T.ZP,{onClick:a,children:"\u9884\u89C8"}),(0,o.jsx)(T.ZP,{onClick:d,children:"\u4FDD\u5B58"}),(0,o.jsx)(T.ZP,{onClick:C,children:"\u6E05\u7A7A\u753B\u5E03"})]})},Me=(0,S.connect)(function(e){return e.drag})(Le),M={home:"home___a7EPH",left:"left____LZ0X",right:"right___q0hdW","el-select":"el-select___nSETD",center:"center___VV5Nh",content:"content___nGCOl",placeholder:"placeholder___kTIgg","global-attr":"global-attr___yfCe_"},Ne=function(t){var n=t.dispatch,a=t.isClickComponent,r=(0,j.useState)(!1),l=I()(r,2),i=l[0],s=l[1],c=(0,j.useRef)(null),d=function(u){u.preventDefault()},C=function(u){u.preventDefault(),u.stopPropagation();var h=JSON.parse(u.dataTransfer.getData("comType")),w=c.current.editorClient;if(h){var x=(0,E.cloneDeep)(g.d2.find(function(y){return y.type===h}))||{};x.id=(0,N.ZP)(),x.style.top=u.clientY-w.y,x.style.left=u.clientX-w.x,n({type:"drag/addRealtimeList",payload:x})}},D=function(u){u.stopPropagation(),n({type:"drag/setIsClickComponent",payload:!1})},f=function(){a||n({type:"drag/setCurComponent"})};return(0,o.jsxs)("div",{className:M.home,children:[(0,o.jsx)(Me,{onPreview:function(){s(!0)}}),(0,o.jsxs)("main",{className:"flex_start_center",children:[(0,o.jsxs)("section",{className:M.left,children:[(0,o.jsx)(z,{}),(0,o.jsx)(fe,{})]}),(0,o.jsx)("section",{className:M.center,children:(0,o.jsx)("div",{className:M.content,onDragOver:d,onDrop:C,onMouseDown:D,onMouseUp:f,children:(0,o.jsx)(ce,{ref:c})})}),(0,o.jsx)("section",{className:M.right})]}),i&&(0,o.jsx)(he,{visible:i,onCancel:function(){s(!1)}})]})},be=(0,S.connect)(function(e){return e.drag})(Ne)},26789:function(){}}]);
