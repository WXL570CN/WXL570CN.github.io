(self.webpackChunk=self.webpackChunk||[]).push([[866],{4036:function(Ee,O,v){"use strict";v.r(O),v.d(O,{default:function(){return Pe}});var U=v(16854),A=v.n(U),p=v(54573),F={"drag-com-list":"drag-com-list___HNdKj",list:"list___DUYsi",iconfont:"iconfont___AqFtN","icon-wenben":"icon-wenben___f1NRt","icon-biaoge":"icon-biaoge___V8pn2","icon-tupian":"icon-tupian___zzsDD"},a=v(32648),H=function(t){var n=function(o){o.dataTransfer.setData("comType",o.target.dataset.type)};return(0,a.jsx)("div",{className:F["drag-com-list"],onDragStart:n,children:p.d2.map(function(r,o){return(0,a.jsx)("div",{className:F.list,draggable:!0,"data-index":o,"data-type":r.type,children:(0,a.jsx)("i",{className:"iconfont ".concat(r.icon)})},o)})})},Z=H,z=v(67104),m=v.n(z),S=v(77617),_=v(64515),G=function(t){return(0,a.jsxs)("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg",style:{position:"relative",top:0,left:0},children:[(0,a.jsxs)("defs",{children:[(0,a.jsx)("pattern",{id:"smallGrid",width:"7.236328125",height:"7.236328125",patternUnits:"userSpaceOnUse",children:(0,a.jsx)("path",{d:"M 7.236328125 0 L 0 0 0 7.236328125",fill:"none",stroke:"rgba(207, 207, 207, 0.3)",strokeWidth:"1"})}),(0,a.jsxs)("pattern",{id:"grid",width:"36.181640625",height:"36.181640625",patternUnits:"userSpaceOnUse",children:[(0,a.jsx)("rect",{width:"36.181640625",height:"36.181640625",fill:"url(#smallGrid)"}),(0,a.jsx)("path",{d:"M 36.181640625 0 L 0 0 0 36.181640625",fill:"none",stroke:"rgba(186, 186, 186, 0.5)",strokeWidth:"1"})]})]}),(0,a.jsx)("rect",{width:"100%",height:"100%",fill:"url(#grid)"})]})},B=G,W={lt:V,t:$,rt:J,r:q,rb:K,b:ee,lb:Q,l:te};function V(e,t){var n=e.width,r=e.height,o=e.top,i=e.left,l=Math.max(0,t.x),s=Math.max(0,t.y),c=i-l,d=o-s;e.width=n+c,e.height=r+d,e.top=s,e.left=l}function J(e,t,n){var r=e.height,o=e.top,i=e.left,l=Math.max(0,Math.min(n.width,t.x)),s=Math.max(0,t.y),c=l-i,d=o-s;e.width=c,e.height=r+d,e.top=s}function K(e,t,n){var r=e.top,o=e.left,i=Math.max(0,Math.min(n.width,t.x)),l=Math.max(0,Math.min(n.height,t.y)),s=i-o,c=l-r;e.width=s,e.height=c}function Q(e,t,n){var r=e.width,o=e.top,i=e.left,l=Math.max(0,t.x),s=Math.max(0,Math.min(n.height,t.y)),c=i-l,d=s-o;e.width=r+c,e.height=d,e.left=l}function $(e,t){var n=e.height,r=e.top;if(!(t.y<0)){var o=r-t.y;e.height=n+o,e.top=t.y}}function q(e,t,n){var r=n.width;if(!(t.x>r)){var o=t.x-e.left;e.width=o}}function ee(e,t,n){var r=n.height;t.y>r||(e.height=t.y-e.top)}function te(e,t){var n=e.width,r=e.left;if(!(t.x<0)){var o=r-t.x;e.width=n+o,e.left=t.x}}function ne(e,t,n,r){W[e](t,n,r)}function ae(e,t,n,r){var o=r.width,i=r.height,l=n.x+t.left,s=n.y+t.top;e.left=Math.max(0,Math.min(l,o-e.width)),e.top=Math.max(0,Math.min(s,i-e.height))}var oe=function(t,n){var r=n.width,o=n.height,i=r/2,l=o/2,s={lt:[0,0],rt:[r,0],lb:[0,o],rb:[r,o],t:[i,0],b:[i,o],l:[0,Math.floor(l)],r:[r,Math.floor(l)]}[t];return{marginLeft:"-4px",marginTop:"-4px",left:"".concat(s[0],"px"),top:"".concat(s[1],"px"),cursor:p.uJ[t]}},b={shape:"shape___VmOGv","shape-point":"shape-point___qcRVh",delete:"delete___JJKkb",active:"active___bNgQ4"},re=function(t){var n=t.dispatch,r=t.style,o=t.element,i=t.children,l=t.editorClient,s=t.isPreview,c=t.curComponent,d=function(C){n({type:"drag/setIsClickComponent",payload:!0}),C.stopPropagation(),n({type:"drag/setCurComponent",payload:o});var u=m()({},r),h={x:C.clientX,y:C.clientY},x={top:Number(u.top),left:Number(u.left)},g=function(D){var L={x:D.clientX-h.x,y:D.clientY-h.y};ae(u,x,L,p.YA),n({type:"drag/updateCurComponent",payload:u})},f=function y(){document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",y)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",f)},j=function(C,u){if(!s){u.stopPropagation(),u.preventDefault();var h=m()({},r),x=function(y){var D={x:y.clientX-Math.round(l.left),y:y.clientY-Math.round(l.top)};ne(C,h,D,p.YA),n({type:"drag/updateCurComponent",payload:h,element:o})},g=function f(){document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",f)};document.addEventListener("mousemove",x),document.addEventListener("mouseup",g)}},M=!s&&(c==null?void 0:c.id)===o.id;return(0,a.jsxs)("div",{className:"".concat(b.shape," ").concat(M?b.active:""),onMouseDown:d,style:r,children:[M&&p.mw.map(function(w){return(0,a.jsx)("div",{className:"".concat(b["shape-point"]," "),style:oe(w,r),onMouseDown:function(u){j(w,u)}},w)}),i]})},I=(0,_.connect)(function(e){return e.drag})(re),ie={editor:"editor___wGPeX",lock:"lock___PlZuI"},le=S.forwardRef(function(e,t){var n=(0,_.useSelector)(function(c){return c.drag}),r=n.curComponent,o=n.realtimeList,i=(0,S.useRef)(null),l=function(){var d;return(d=i.current)===null||d===void 0?void 0:d.getBoundingClientRect()};(0,S.useImperativeHandle)(t,function(){return{editorClient:l()}});var s=function(d){r||d.preventDefault()};return(0,a.jsxs)("div",{ref:i,className:ie.editor,style:p.YA,onMouseDown:s,children:[(0,a.jsx)(B,{}),o.map(function(c,d){var j=p.Iq[c.type];return(0,a.jsx)(I,{style:m()(m()({},c.style),{},{zIndex:o.length-d}),element:c,editorClient:l(),children:(0,a.jsx)(j,m()({},c))},c.id)})]})}),ce=le,se=v(48163),N=v(18893),Y=v(37103),de=v(90017),ue={"preview-modal":"preview-modal___HfH8T"},he=function(t){var n=t.open,r=t.isScreenshot,o=t.realtimeList,i=(0,S.useRef)(null),l=(0,S.useState)(0),s=A()(l,2),c=s[0],d=s[1];(0,S.useEffect)(function(){n&&d(M())},[n]);var j=function(){console.log("=="),(0,de.YM)(i.current).then(function(u){console.log("\u300EdataUrl\u300F",u);var h=document.createElement("a");h.setAttribute("download","screenshot"),h.href=u,h.click()}).catch(function(u){console.error("oops, something went wrong!",u)}).finally(function(){t.onCancel()})},M=function(){var u=i.current||{},h=u.clientHeight,x=u.clientWidth;return(0,Y.yZ)(p.YA.width,p.YA.height,x,h)},w=function(){return(0,a.jsx)("div",{style:m()(m()({},p.YA),{},{position:"relative",transform:"scale(".concat(c,")"),transformOrigin:"0% 0%"}),children:o.map(function(u,h){var x=p.Iq[u.type];return(0,a.jsx)(I,{style:u.style,isPreview:!0,children:(0,a.jsx)(x,m()(m()({},u),{},{visible:!0}))},u.id)})})};return(0,a.jsx)(se.Z,m()(m()({title:"\u9884\u89C8"},t),{},{width:800,footer:r?(0,a.jsx)(N.ZP,{onClick:j,children:"\u622A\u56FE"}):null,forceRender:!0,className:ue["preview-modal"],children:(0,a.jsx)("div",{ref:i,style:{width:"100%",height:"100%"},children:c&&w()})}))},ve=(0,_.connect)(function(e){return e.drag})(he),P={"real-time-component-list":"real-time-component-list___DixQO",list:"list___xS3kl",active:"active___wOdDF",name:"name___EmUss","icon-container":"icon-container___PdGfq"},fe=function(t){var n=t.dispatch,r=t.realtimeList,o=t.curComponent;return(0,a.jsx)("div",{className:P["real-time-component-list"],children:r.map(function(i,l){var s=(o==null?void 0:o.id)===i.id;return(0,a.jsxs)("div",{className:"flex_start_center ".concat(P.list," ").concat(s&&P.active),onClick:function(){n({type:"drag/setCurComponent",payload:i})},children:[(0,a.jsx)("i",{className:"iconfont ".concat(i.icon)}),(0,a.jsx)("span",{className:P.name,children:i.label}),(0,a.jsxs)("div",{className:P["icon-container"],children:[(0,a.jsx)("i",{className:"iconfont icon-drag-up",onClick:function(){n({type:"drag/moveUpComponent",payload:l})}}),(0,a.jsx)("i",{className:"iconfont icon-drag-down",onClick:function(){n({type:"drag/moveDownComponent",payload:l})}}),(0,a.jsx)("i",{className:"iconfont icon-drag-delete",onClick:function(){n({type:"drag/deleteComponent",payload:i.id})}})]})]},l)})})},me=(0,_.connect)(function(e){return m()({},e.drag)})(fe),pe=v(28911),k=v(89392),T=v(36798),ge=["top","left","width","height","fontSize"];function Ce(e,t){var n=t.realtimeList,r=t.canvasStyle,o=(0,k.cloneDeep)(n);return o.forEach(function(i){Object.keys(i.style).forEach(function(l){if(ge.includes(l)){if(l==="fontSize"&&i.style[l]==="")return;i.style[l]=X(we(i.style[l],store.state.canvasStyleData.scale),e)}})}),{realtimeList:o,canvasStyle:m()(m()({},r),{},{scale:e})}}var xe=null;function Re(e,t){Object.keys(e.style).forEach(function(n){if(xe.includes(n)){if(n==="fontSize"&&e.style[n]==="")return;e.style[n]=X(e.style[n],t)}})}function X(e,t){return(0,T.JpY)(e,(0,T.csF)(parseFloat(t),100))}function we(e,t){return(0,T.csF)(e,(0,T.csF)(parseFloat(t),100))}var je=v(57600),ye={insert:"insert___jDqYs"},Se=function(t){var n=function(o){var i=o.target.files[0];if(!i.type.includes("image")){toast("\u53EA\u80FD\u63D2\u5165\u56FE\u7247");return}var l=new FileReader;l.onload=function(s){var c=s.target.result,d=new Image;d.onload=function(){t.onChange({url:c,width:d.width,height:d.height})},d.src=c},l.readAsDataURL(i)};return(0,a.jsxs)("label",{htmlFor:"input",className:ye.insert,children:["\u63D2\u5165\u56FE\u7247",(0,a.jsx)("input",{id:"input",type:"file",hidden:!0,onChange:n})]})},De=(0,_.connect)(function(e){return e.drag})(Se),Me={toolbar:"toolbar___NSLzd","canvas-config":"canvas-config___pkiFM"},Le=function(t){var n=t.dispatch,r=t.onPreview,o=t.realtimeList,i=t.canvasStyle,l=function(){},s=function(){},c=function(){},d=function(){je.Z.set({name:"drag_data",value:o}),pe.ZP.success("\u4FDD\u5B58\u6210\u529F\uFF01")},j=function(){n({type:"drag/setRealtimeList",payload:[]})([])},M=function(){},w=function(){},C=function(){},u=function(x){var g=x||{},f=g.width,y=g.height,D=g.url,L=(0,Y.jD)(p.d2,p.mM.IMG,{valueName:"type"}),R=m()(m()({},L),{},{propValue:D,style:m()({top:0,left:0},(0,Y.lk)(f,y))});Ce(R,{realtimeList:o,canvasStyle:i}),n({type:"drag/setCurComponent",payload:R}),n({type:"drag/addRealtimeList",payload:R})};return(0,a.jsxs)("div",{className:"flex_start_center ".concat(Me.toolbar),children:[(0,a.jsx)(De,{onChange:u}),(0,a.jsx)(N.ZP,{onClick:function(){r()},children:"\u9884\u89C8"}),(0,a.jsx)(N.ZP,{onClick:d,children:"\u4FDD\u5B58"}),(0,a.jsx)(N.ZP,{onClick:j,children:"\u6E05\u7A7A\u753B\u5E03"}),(0,a.jsx)(N.ZP,{onClick:function(){r(!0)},children:"\u622A\u56FE"})]})},_e=(0,_.connect)(function(e){return e.drag})(Le),E={home:"home___a7EPH",left:"left____LZ0X",right:"right___q0hdW","el-select":"el-select___nSETD",center:"center___VV5Nh",content:"content___nGCOl",placeholder:"placeholder___kTIgg","global-attr":"global-attr___yfCe_"},Ne=function(t){var n=t.dispatch,r=t.isClickComponent,o=(0,S.useState)(!1),i=A()(o,2),l=i[0],s=i[1],c=(0,S.useState)(!1),d=A()(c,2),j=d[0],M=d[1],w=(0,S.useRef)(null),C=function(f){f.preventDefault()},u=function(f){f.preventDefault(),f.stopPropagation();var y=JSON.parse(f.dataTransfer.getData("comType")),D=w.current.editorClient;if(y){var L=(0,k.cloneDeep)(p.d2.find(function(R){return R.type===y}))||{};L.id=(0,Y.ZP)(),L.style.top=f.clientY-D.y,L.style.left=f.clientX-D.x,n({type:"drag/addRealtimeList",payload:L})}},h=function(f){f.stopPropagation(),n({type:"drag/setIsClickComponent",payload:!1})},x=function(){r||n({type:"drag/setCurComponent"})};return(0,a.jsxs)("div",{className:E.home,children:[(0,a.jsx)(_e,{onPreview:function(f){s(f),M(!0)}}),(0,a.jsxs)("main",{className:"flex_start_center",children:[(0,a.jsxs)("section",{className:E.left,children:[(0,a.jsx)(Z,{}),(0,a.jsx)(me,{})]}),(0,a.jsx)("section",{className:E.center,children:(0,a.jsx)("div",{className:E.content,onDragOver:C,onDrop:u,onMouseDown:h,onMouseUp:x,children:(0,a.jsx)(ce,{ref:w})})}),(0,a.jsx)("section",{className:E.right})]}),j&&(0,a.jsx)(ve,{open:j,isScreenshot:l,onCancel:function(){M(!1),s(!1)}})]})},Pe=(0,_.connect)(function(e){return e.drag})(Ne)},26789:function(){}}]);
